<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Improved USI course finder SS26</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <style>
        .full { color: #ef4444; font-weight: bold; }
        .available { color: #22c55e; font-weight: bold; }
        .col-name { width: 25%; font-weight: 700; }
        .col-dist { width: 6%; font-weight: 800; color: #4f46e5; text-align: center; }
        .click-filter { cursor: pointer; color: #000; text-decoration: underline; text-underline-offset: 3px; }
        .click-filter:hover { color: #4f46e5; }
        table.dataTable thead th { background-color: #4f46e5 !important; color: white !important; text-align: left; border: none !important; }
        .v-line { width: 1px; background-color: #cbd5e1; margin: 0 0.8rem; }
        .dataTables_filter { display: none; }
        .checkbox-item { display: flex; align-items: center; gap: 0.4rem; cursor: pointer; font-size: 0.75rem; padding: 1px 4px; border-radius: 4px; }
        .checkbox-item:hover { background-color: #e0e7ff; }
        .time-select { width: 75px; padding: 4px; border-radius: 8px; border: 1px solid #c7d2fe; font-size: 0.8rem; font-weight: 600; }
        .online-tag { background-color: #dcfce7; color: #166534; padding: 2px 6px; border-radius: 6px; font-weight: bold; font-size: 0.7rem; }
    </style>
</head>
<body class="bg-slate-50 p-4 md:p-6 font-sans text-slate-900">

    <div class="max-w-full mx-auto bg-white p-6 md:p-10 rounded-[2.5rem] shadow-2xl border border-indigo-50">
        <h1 class="text-3xl font-black text-indigo-900 mb-8 tracking-tighter">Improved USI course finder SS26</h1>

        <div class="bg-indigo-50 p-6 rounded-3xl border border-indigo-100 shadow-sm mb-8">
            <div class="flex flex-col xl:flex-row gap-8 items-start">

                <div class="flex-none w-full xl:w-1/4 space-y-4">
                    <div>
                        <label class="block text-xs font-black text-indigo-600 mb-1 uppercase tracking-widest">Search Course</label>
                        <input type="text" id="custom-search" placeholder="Course, Instructor, Place..." class="w-full p-2 rounded-xl border-indigo-200 shadow-sm">
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="text-[10px] font-black text-indigo-600 uppercase">Start from:</span>
                        <select id="filter-start-after" class="time-select"></select>
                        <span class="text-[10px] font-black text-indigo-600 uppercase ml-2">End until:</span>
                        <select id="filter-end-before" class="time-select"></select>
                    </div>
                    <label class="flex items-center gap-2 cursor-pointer group w-max">
                        <input type="checkbox" id="check-free" class="w-4 h-4 rounded border-indigo-300 text-indigo-600">
                        <span class="text-xs font-bold text-indigo-900">Free spots only</span>
                    </label>
                </div>

                <div class="flex-none">
                    <label class="block text-xs font-black text-indigo-600 mb-2 uppercase tracking-widest">Districts</label>
                    <div class="flex">
                        <div class="space-y-0.5"><label class="checkbox-item"><input type="checkbox" class="dist-checkbox" value="1."> 1.</label><label class="checkbox-item"><input type="checkbox" class="dist-checkbox" value="2."> 2.</label><label class="checkbox-item"><input type="checkbox" class="dist-checkbox" value="3."> 3.</label><label class="checkbox-item"><input type="checkbox" class="dist-checkbox" value="4."> 4.</label><label class="checkbox-item"><input type="checkbox" class="dist-checkbox" value="5."> 5.</label></div>
                        <div class="v-line self-stretch"></div>
                        <div class="space-y-0.5"><label class="checkbox-item"><input type="checkbox" class="dist-checkbox" value="6."> 6.</label><label class="checkbox-item"><input type="checkbox" class="dist-checkbox" value="7."> 7.</label><label class="checkbox-item"><input type="checkbox" class="dist-checkbox" value="8."> 8.</label><label class="checkbox-item"><input type="checkbox" class="dist-checkbox" value="9."> 9.</label><label class="checkbox-item"><input type="checkbox" class="dist-checkbox" value="10."> 10.</label></div>
                        <div class="v-line self-stretch"></div>
                        <div class="space-y-0.5"><label class="checkbox-item"><input type="checkbox" class="dist-checkbox" value="11."> 11.</label><label class="checkbox-item"><input type="checkbox" class="dist-checkbox" value="12."> 12.</label><label class="checkbox-item"><input type="checkbox" class="dist-checkbox" value="13."> 13.</label><label class="checkbox-item"><input type="checkbox" class="dist-checkbox" value="14."> 14.</label><label class="checkbox-item"><input type="checkbox" class="dist-checkbox" value="15."> 15.</label></div>
                        <div class="v-line self-stretch"></div>
                        <div class="space-y-0.5"><label class="checkbox-item"><input type="checkbox" class="dist-checkbox" value="16."> 16.</label><label class="checkbox-item"><input type="checkbox" class="dist-checkbox" value="17."> 17.</label><label class="checkbox-item"><input type="checkbox" class="dist-checkbox" value="18."> 18.</label><label class="checkbox-item"><input type="checkbox" class="dist-checkbox" value="19."> 19.</label><label class="checkbox-item"><input type="checkbox" class="dist-checkbox" value="20."> 20.</label></div>
                        <div class="v-line self-stretch"></div>
                        <div class="space-y-0.5"><label class="checkbox-item"><input type="checkbox" class="dist-checkbox" value="21."> 21.</label><label class="checkbox-item"><input type="checkbox" class="dist-checkbox" value="22."> 22.</label><label class="checkbox-item"><input type="checkbox" class="dist-checkbox" value="23."> 23.</label><label class="checkbox-item font-bold text-indigo-600"><input type="checkbox" class="dist-checkbox" value="Not in Vienna"> Outside</label><label class="checkbox-item font-bold text-green-600"><input type="checkbox" class="dist-checkbox" value="Online"> Online</label></div>
                    </div>
                </div>

                <div class="flex-none">
                    <label class="block text-xs font-black text-indigo-600 mb-2 uppercase tracking-widest">Days</label>
                    <div class="flex">
                        <div class="space-y-0.5">
                            <label class="checkbox-item"><input type="checkbox" class="day-checkbox" value="Monday"> Mon</label>
                            <label class="checkbox-item"><input type="checkbox" class="day-checkbox" value="Tuesday"> Tue</label>
                            <label class="checkbox-item"><input type="checkbox" class="day-checkbox" value="Wednesday"> Wed</label>
                            <label class="checkbox-item"><input type="checkbox" class="day-checkbox" value="Thursday"> Thu</label>
                        </div>
                        <div class="v-line self-stretch"></div>
                        <div class="space-y-0.5">
                            <label class="checkbox-item"><input type="checkbox" class="day-checkbox" value="Friday"> Fri</label>
                            <label class="checkbox-item"><input type="checkbox" class="day-checkbox" value="Saturday"> Sat</label>
                            <label class="checkbox-item"><input type="checkbox" class="day-checkbox" value="Sunday"> Sun</label>
                            <label class="checkbox-item font-bold text-indigo-600"><input type="checkbox" class="day-checkbox" value="Block,N/A"> Block</label>
                        </div>
                    </div>
                </div>

                <div class="xl:ml-auto self-end">
                    <button id="btn-reset" class="bg-white border px-4 py-2 rounded-xl font-bold hover:bg-slate-100 transition shadow-sm">Reset</button>
                </div>
            </div>
        </div>

        <table id="usiTable" class="display w-full text-sm">
            <thead>
                <tr>
                    <th>No.</th>
                    <th>Course Name</th>
                    <th>Day</th>
                    <th>Start</th>
                    <th>End until</th>
                    <th>Instructor</th>
                    <th>Dist.</th>
                    <th>Location</th>
                    <th>Spots</th>
                    <th>Price</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        $(document).ready(function() {
            const startSelect = $('#filter-start-after');
            const endSelect = $('#filter-end-before');
            for (let h = 0; h < 24; h++) {
                for (let m = 0; m < 60; m += 30) {
                    const t = `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
                    startSelect.append(new Option(t, t)); endSelect.append(new Option(t, t));
                }
            }
            startSelect.val('00:00'); endSelect.val('23:30');

            const table = $('#usiTable').DataTable({
                ajax: { url: 'usi_data_complete.json', dataSrc: '' },
                dom: 'lrtip', pageLength: 100,
                lengthMenu: [[50, 100, 500, -1], [50, 100, 500, "All"]],
                order: [[1, 'asc']],
                columns: [
                    { data: 'kursnummer', className: 'text-slate-400 font-mono text-xs' },
                    { data: 'titel', className: 'col-name', render: (d, t, r) => `<a href="${r.link}" target="_blank" class="text-indigo-600">${d}</a>` },
                    { data: 'wochentag' },
                    { data: 'beginn', render: (d, t, r) => (r.wochentag === "Block" || d === "Multiple") ? `<span class="italic text-indigo-400">${d}</span>` : `<strong>${d}</strong>` },
                    { data: 'ende', render: (d, t, r) => (r.wochentag === "Block" || d === "Multiple") ? "" : d },
                    { data: 'lehrer', render: (d) => `<span class="click-filter">${d}</span>` },
                    { data: 'bezirk', className: 'col-dist', render: (d) => d === 'Online' ? `<span class="online-tag">ON</span>` : d },
                    { data: 'ort', render: (d) => `<span class="click-filter">${d}</span>` },
                    { data: null, render: (d) => `<span class="${d.angemeldet >= d.max_teilnehmer ? 'full' : 'available'}">${d.angemeldet}/${d.max_teilnehmer}</span>` },
                    { data: 'preis3', type: 'num', render: (d, t, r) => `<span class="font-mono text-xs text-slate-600">${r.preis1}/${r.preis2}/${r.preis3}</span>` }
                ]
            });

            $.fn.dataTable.ext.search.push(function(settings, data, dataIndex) {
                const days = $('.day-checkbox:checked').map(function() { return $(this).val().split(','); }).get().flat();
                const dists = $('.dist-checkbox:checked').map(function() { return $(this).val().split(','); }).get().flat();
                const start = $('#filter-start-after').val(), end = $('#filter-end-before').val();
                const free = $('#check-free').is(':checked');

                const rDay = data[2], rStart = data[3], rEnd = data[4], rDist = data[6];
                const spots = data[8].split('/'), isFull = parseInt(spots[0]) >= parseInt(spots[1]);

                if (dists.length > 0 && !dists.some(d => rDist.includes(d))) return false;
                if (days.length > 0 && !days.some(d => rDay.includes(d))) return false;
                if (free && isFull) return false;
                if (rStart && !["Block", "Multiple", "N/A"].includes(rStart)) {
                    if (start && rStart < start) return false;
                    if (end && rEnd > end) return false;
                }
                return true;
            });

            $('.day-checkbox, .dist-checkbox, #check-free, #filter-start-after, #filter-end-before').on('change', () => table.draw());
            $('#custom-search').on('keyup', function() { table.search(this.value).draw(); });
            $('#usiTable tbody').on('click', '.click-filter', function() {
                const v = $(this).text().trim(); $('#custom-search').val(v); table.search(v).draw();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
            $('#btn-reset').on('click', function() {
                $('.day-checkbox, .dist-checkbox, #check-free').prop('checked', false);
                $('#filter-start-after').val('00:00'); $('#filter-end-before').val('23:30');
                $('#custom-search').val(''); table.search('').draw();
            });
        });
    </script>
</body>
</html>
